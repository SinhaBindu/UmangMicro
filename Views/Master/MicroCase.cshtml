@model UmangMicro.Models.MicroCaseModel
@using UmangMicro.Manager
@{
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}

<style>
    .tox-notification {
        display: none !important;
    }

    .tox-statusbar__branding {
        display: none !important;
    }
</style>


<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                @using (Html.BeginForm("MicroCase", "Master", FormMethod.Post, new { @id = "formid", @class = "", role = "form", autocomplete = "off", enctype = "multipart/form-data" }))
                {
                    <div class="form-row">
                        <div class="col-md-12">
                            <div style="text-align: center; font-weight: 700;">
                                <h4><strong>Add Case Studies</strong></h4>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="position-relative form-group">
                                @Html.HiddenFor(model => model.ID)
                                @Html.AntiForgeryToken()
                                @Html.ValidationSummary("", new { @class = "text-danger ulcl" })
                                <div class="col-md-12">@Html.Partial("_Alerts")</div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-group">
                                <span class="text-danger">*</span>
                                @Html.LabelFor(model => model.Subject, htmlAttributes: new { @class = "" })
                                @Html.TextAreaFor(model => model.Subject, new { @class = "form-control", @required = "required", @rows = "5", @cols = "10" })
                                @Html.ValidationMessageFor(model => model.Subject, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="position-relative form-group">
                                <span class="text-danger">*</span>
                                <label>Photo</label>
                                <input type="file" name="Photo" id="Photo" accept="image/*" required class="form-control" />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="position-relative form-group">
                                <span class="text-danger">*</span>
                                @Html.LabelFor(model => model.HtmlEditor, htmlAttributes: new { @class = "" })
                                <textarea id="HtmlEditor" name="HtmlEditor" required></textarea>
                                @Html.ValidationMessageFor(model => model.HtmlEditor, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="mt-4 mb-4 d-flex align-items-center">
                                <div class="ml-auto">
                                    <input type="submit" class="btn-wide btn-pill btn-shadow btn-hover-shine btn btn-primary btn-small" value="Submit" />
                                </div>
                            </div>
                        </div>

                    </div>
                }

            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <!-- Include Editor JS files. -->
    <script src="https://cdn.tiny.cloud/1/sycl3w1d8npikolltg56dvhf7yiehfqo9a8sbnei0nokfddz/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

    <script>
        //new FroalaEditor('textarea#froala-editor');
        //new FroalaEditor('textarea#froala-editor', {
        //    heightMin: 800,
        //    heightMax: 1000
        //})
        $(function () {
            LoadEditor();
            
            /* Started Submitted Tab */
            $("#formid").on("submit", function (event) {
                event.preventDefault();
                jQuery.event.trigger("ajaxStart");
                debugger;
                var isvalid = $("#formid").valid(); 
                var formData = $(this).serialize();
                if (isvalid) {
                    $.ajax({
                        type: "POST",
                        url: document.baseURI + "/Master/MicroCase/",
                        data: formData,
                        //use contentType, processData for sure.
                        //contentType: false,
                        // processData: false,
                        dataType: "json",
                        //contentType: "application/json; charset=utf-8",
                        success: function (resp) {
                            //  CreateToasterMessage("Registration", resp.Message, resp.StatusType);
                            if (resp.StatusType == "success") {
                                toastr.success("Success", resp.Message);
                                if (resp.Data == 1) {
                                    var url = '@Url.Action("Login", "Account")';
                                    window.location.href = url;
                                }
                                jQuery.event.trigger("ajaxStop");
                            }
                        },
                        error: function (req, error) {
                            if (error === 'error') { error = req.statusText; }
                            var errormsg = 'There was a communication error: ' + error;
                            // CreateToasterMessage("Error", errormsg, "error");
                            toastr.error("Error", errormsg);
                            jQuery.event.trigger("ajaxStop");
                            return false;
                        }

                    });
                }
                else {
                    //CreateToasterMessage("Error", "All Record Validate !!", "error");
                    toastr.error("Error", "All Record Validate !!");
                    jQuery.event.trigger("ajaxStop");
                    return false;
                }
            });/*End Submitted Closed Tab  */

        });

        function LoadEditor() {
            tinymce.init({
                selector: '#HtmlEditor',
                plugins: 'a11ychecker advcode casechange export formatpainter linkchecker autolink lists checklist media mediaembed pageembed permanentpen powerpaste table advtable tableofcontents tinycomments tinymcespellchecker',
                toolbar: 'a11ycheck addcomment showcomments casechange checklist code export formatpainter pageembed permanentpen table tableofcontents',
                toolbar_mode: 'floating',
                tinycomments_mode: 'embedded',
                tinycomments_author: 'Author name',
                //codesample_global_prismjs: true
                //paste_data_images: false,
                smart_paste: false,
            });
            tinymce.init({
                selector: '#HtmlEditor',
                plugins: 'a11ychecker advcode casechange export formatpainter linkchecker autolink lists checklist media mediaembed pageembed permanentpen powerpaste table advtable tableofcontents tinycomments tinymcespellchecker',
                toolbar: 'a11ycheck addcomment showcomments casechange checklist code export formatpainter pageembed permanentpen table tableofcontents',
                toolbar_mode: 'floating',
                tinycomments_mode: 'embedded',
                tinycomments_author: 'Author name',
                //codesample_global_prismjs: true

            });
        }
        function ClearInput() {
            $('#Subject').val('');
            $('#Photo').val('');
            $('#HtmlEditor').val('');
        }

    </script>

}
